<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Modelling | STAT 454 Bayesian Statistics - Pet Adoption</title>
  <meta name="description" content="Chapter 7 Modelling | STAT 454 Bayesian Statistics - Pet Adoption" />
  <meta name="generator" content="bookdown 0.18.1 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Modelling | STAT 454 Bayesian Statistics - Pet Adoption" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="connie-zhang/pet-adoption" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Modelling | STAT 454 Bayesian Statistics - Pet Adoption" />
  
  
  

<meta name="author" content="Connie Zhang, Spring 2020 Macalester College" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ordered-logistic-regression.html"/>
<link rel="next" href="final-model.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a></li>
<li class="chapter" data-level="2" data-path="motivation.html"><a href="motivation.html"><i class="fa fa-check"></i><b>2</b> Motivation</a></li>
<li class="chapter" data-level="3" data-path="data-source.html"><a href="data-source.html"><i class="fa fa-check"></i><b>3</b> Data Source</a><ul>
<li class="chapter" data-level="3.1" data-path="data-source.html"><a href="data-source.html#variable-table"><i class="fa fa-check"></i><b>3.1</b> Variable Table</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-cleaning.html"><a href="data-cleaning.html"><i class="fa fa-check"></i><b>4</b> Data Cleaning</a></li>
<li class="chapter" data-level="5" data-path="visualizations.html"><a href="visualizations.html"><i class="fa fa-check"></i><b>5</b> Visualizations</a><ul>
<li class="chapter" data-level="5.1" data-path="visualizations.html"><a href="visualizations.html#general-impressions"><i class="fa fa-check"></i><b>5.1</b> General Impressions</a></li>
<li class="chapter" data-level="5.2" data-path="visualizations.html"><a href="visualizations.html#starting-off"><i class="fa fa-check"></i><b>5.2</b> Starting off</a><ul>
<li class="chapter" data-level="5.2.1" data-path="visualizations.html"><a href="visualizations.html#type"><i class="fa fa-check"></i><b>5.2.1</b> Type</a></li>
<li class="chapter" data-level="5.2.2" data-path="visualizations.html"><a href="visualizations.html#health-related-factors"><i class="fa fa-check"></i><b>5.2.2</b> Health-related factors</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="visualizations.html"><a href="visualizations.html#more-digging"><i class="fa fa-check"></i><b>5.3</b> More digging</a><ul>
<li class="chapter" data-level="5.3.1" data-path="visualizations.html"><a href="visualizations.html#age-and-age-group"><i class="fa fa-check"></i><b>5.3.1</b> Age and Age Group</a></li>
<li class="chapter" data-level="5.3.2" data-path="visualizations.html"><a href="visualizations.html#the-mysterious-breed-307"><i class="fa fa-check"></i><b>5.3.2</b> The mysterious Breed 307</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="visualizations.html"><a href="visualizations.html#other-factors"><i class="fa fa-check"></i><b>5.4</b> Other factors</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ordered-logistic-regression.html"><a href="ordered-logistic-regression.html"><i class="fa fa-check"></i><b>6</b> Ordered Logistic Regression</a><ul>
<li class="chapter" data-level="6.1" data-path="ordered-logistic-regression.html"><a href="ordered-logistic-regression.html#proportional-odds-assumption"><i class="fa fa-check"></i><b>6.1</b> Proportional Odds Assumption</a></li>
<li class="chapter" data-level="6.2" data-path="ordered-logistic-regression.html"><a href="ordered-logistic-regression.html#interpretation"><i class="fa fa-check"></i><b>6.2</b> Interpretation</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="modelling.html"><a href="modelling.html"><i class="fa fa-check"></i><b>7</b> Modelling</a><ul>
<li class="chapter" data-level="7.1" data-path="modelling.html"><a href="modelling.html#model-1"><i class="fa fa-check"></i><b>7.1</b> Model 1</a><ul>
<li class="chapter" data-level="7.1.1" data-path="modelling.html"><a href="modelling.html#posterior-inference"><i class="fa fa-check"></i><b>7.1.1</b> Posterior Inference</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="modelling.html"><a href="modelling.html#model-2"><i class="fa fa-check"></i><b>7.2</b> Model 2</a><ul>
<li class="chapter" data-level="7.2.1" data-path="modelling.html"><a href="modelling.html#model-building"><i class="fa fa-check"></i><b>7.2.1</b> Model Building</a></li>
<li class="chapter" data-level="7.2.2" data-path="modelling.html"><a href="modelling.html#posterior-inference-1"><i class="fa fa-check"></i><b>7.2.2</b> Posterior Inference</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="modelling.html"><a href="modelling.html#making-some-adjustments"><i class="fa fa-check"></i><b>7.3</b> Making some adjustments</a></li>
<li class="chapter" data-level="7.4" data-path="modelling.html"><a href="modelling.html#model-3"><i class="fa fa-check"></i><b>7.4</b> Model 3</a><ul>
<li class="chapter" data-level="7.4.1" data-path="modelling.html"><a href="modelling.html#model-building-1"><i class="fa fa-check"></i><b>7.4.1</b> Model Building</a></li>
<li class="chapter" data-level="7.4.2" data-path="modelling.html"><a href="modelling.html#posterior-inference-2"><i class="fa fa-check"></i><b>7.4.2</b> Posterior Inference</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="final-model.html"><a href="final-model.html"><i class="fa fa-check"></i><b>8</b> Final Model</a><ul>
<li class="chapter" data-level="8.1" data-path="final-model.html"><a href="final-model.html#model-building-2"><i class="fa fa-check"></i><b>8.1</b> Model Building</a></li>
<li class="chapter" data-level="8.2" data-path="final-model.html"><a href="final-model.html#diagnostic-plots"><i class="fa fa-check"></i><b>8.2</b> Diagnostic Plots</a></li>
<li class="chapter" data-level="8.3" data-path="final-model.html"><a href="final-model.html#posterior-inference-3"><i class="fa fa-check"></i><b>8.3</b> Posterior Inference</a></li>
<li class="chapter" data-level="8.4" data-path="final-model.html"><a href="final-model.html#discussion"><i class="fa fa-check"></i><b>8.4</b> Discussion</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="shiny-apps.html"><a href="shiny-apps.html"><i class="fa fa-check"></i><b>9</b> Shiny Apps!</a><ul>
<li class="chapter" data-level="9.1" data-path="shiny-apps.html"><a href="shiny-apps.html#user-input"><i class="fa fa-check"></i><b>9.1</b> User Input</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="final-reflections.html"><a href="final-reflections.html"><i class="fa fa-check"></i><b>10</b> Final Reflections</a><ul>
<li class="chapter" data-level="10.1" data-path="final-reflections.html"><a href="final-reflections.html#advice-for-first-time-capstone-people"><i class="fa fa-check"></i><b>10.1</b> Advice for first time capstone people</a></li>
<li class="chapter" data-level="10.2" data-path="final-reflections.html"><a href="final-reflections.html#acknowledgements"><i class="fa fa-check"></i><b>10.2</b> Acknowledgements</a></li>
<li class="chapter" data-level="10.3" data-path="final-reflections.html"><a href="final-reflections.html#citations"><i class="fa fa-check"></i><b>10.3</b> Citations</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">STAT 454 Bayesian Statistics - Pet Adoption</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="modelling" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> Modelling</h1>
<p>First, let’s load some essential package.</p>
<p>We will also create a sample of 1000 for faster modelling.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1"><span class="kw">load</span>(<span class="st">&quot;adoption.RData&quot;</span>)</a>
<a class="sourceLine" id="cb27-2" title="2"><span class="kw">set.seed</span>(<span class="dv">454</span>)</a>
<a class="sourceLine" id="cb27-3" title="3">mysample &lt;-<span class="st"> </span>adoption[<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(adoption), <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb27-4" title="4">   <span class="dt">replace=</span><span class="ot">FALSE</span>),]</a></code></pre></div>
<p>Below is the function I wrote to compute the accuracy of each model.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" title="1">ordinal_accuracy&lt;-<span class="cf">function</span>(post_preds,mydata){</a>
<a class="sourceLine" id="cb28-2" title="2">  post_preds&lt;-<span class="kw">as.data.frame</span>(post_preds)</a>
<a class="sourceLine" id="cb28-3" title="3">  results&lt;-<span class="kw">c</span>()</a>
<a class="sourceLine" id="cb28-4" title="4">  <span class="cf">for</span> (j <span class="cf">in</span> (<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(post_preds))){</a>
<a class="sourceLine" id="cb28-5" title="5">    results[j]&lt;-<span class="kw">as.numeric</span>(<span class="kw">tail</span>(<span class="kw">names</span>(<span class="kw">sort</span>(<span class="kw">table</span>(post_preds[,j]))))[<span class="dv">5</span>])</a>
<a class="sourceLine" id="cb28-6" title="6">    }</a>
<a class="sourceLine" id="cb28-7" title="7">  results&lt;-<span class="kw">as.data.frame</span>(results)</a>
<a class="sourceLine" id="cb28-8" title="8">  compare&lt;-<span class="kw">cbind</span>(results,mydata<span class="op">$</span>AdoptionSpeed)</a>
<a class="sourceLine" id="cb28-9" title="9">  compare&lt;-compare <span class="op">%&gt;%</span><span class="kw">mutate</span>(<span class="dt">results=</span><span class="kw">as.numeric</span>(results))</a>
<a class="sourceLine" id="cb28-10" title="10">  compare&lt;-compare <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">mydata$AdoptionSpeed</span><span class="st">`</span>=<span class="kw">as.numeric</span>(<span class="st">`</span><span class="dt">mydata$AdoptionSpeed</span><span class="st">`</span>))</a>
<a class="sourceLine" id="cb28-11" title="11">  compare&lt;-compare <span class="op">%&gt;%</span><span class="kw">mutate</span>(<span class="dt">accuracy=</span><span class="kw">ifelse</span>(<span class="kw">as.numeric</span>(results)<span class="op">==</span><span class="kw">as.numeric</span>(<span class="st">`</span><span class="dt">mydata$AdoptionSpeed</span><span class="st">`</span>),<span class="dv">1</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb28-12" title="12">  <span class="kw">print</span>(<span class="kw">sum</span>(compare<span class="op">$</span>accuracy)<span class="op">/</span><span class="kw">length</span>(post_preds))</a>
<a class="sourceLine" id="cb28-13" title="13">}</a></code></pre></div>
<div id="model-1" class="section level2">
<h2><span class="header-section-number">7.1</span> Model 1</h2>
<p>From the “Starting off” section, we see that health factors and type can be useful factors in predicting adoption speed.
For this model, we have to set a R2 prior. I set R2 at 0.5 and what=NULL, which will give us a standard uniform prior on R2.
### Model Building
<span class="math display">\[
\text{Let }Y_i\text{ be the adoption speed with k=0,1,2,3,4.}
\\y_i|(\beta_{0k},\beta_1,...,\beta_6)\sim Bern(\theta_{ki})\text{ where }\theta_{ki}\text{ is the }P(Y_i\leq k)\text{ for the }i^{th}\text{ animal.}
\\log(\frac{\theta_{ki}}{1-\theta_{ki}})=logit(\hat P(Y\leq k))=\beta_{k0}+\beta_1x_1...+\beta_5x_5
\\\text{ where }x_i\text{ for i from 1 to 6 is the indicator for cat, minor injury, severe injury,}
\\\text{sterilization, vaccination, and dewormed.}
\\\beta_{k0}\sim N(m_{k0},s_{k0}^2)
\\\beta_1\sim N(m_1,s_1^2)
\\...\]</span></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1">model1 &lt;-<span class="st"> </span><span class="kw">stan_polr</span>(AdoptionSpeed <span class="op">~</span><span class="st"> </span>Type<span class="op">+</span>Health<span class="op">+</span>Sterilized<span class="op">+</span>Vaccinated<span class="op">+</span>Dewormed, <span class="dt">data =</span>mysample, <span class="dt">prior=</span><span class="kw">R2</span>(<span class="fl">0.5</span>,<span class="dt">what=</span><span class="ot">NULL</span>),<span class="dt">iter=</span><span class="dv">5000</span>, <span class="dt">seed =</span> <span class="dv">454</span>)</a></code></pre></div>
<div id="posterior-inference" class="section level3">
<h3><span class="header-section-number">7.1.1</span> Posterior Inference</h3>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" title="1">model1_summary&lt;-<span class="kw">summary</span>(model1)</a>
<a class="sourceLine" id="cb30-2" title="2"><span class="kw">head</span>(<span class="kw">as.data.frame</span>(model1_summary), <span class="dv">-2</span>)</a></code></pre></div>
<pre><code>##                     mean         mcse          sd         10%          50%
## Type1       -0.291472332 1.067107e-03 0.128917172 -0.45490997 -0.291619825
## Health1      0.441523473 3.135560e-03 0.350471059 -0.01079189  0.437815394
## Health2      2.289862443 1.401822e-02 1.356098798  0.68125324  2.195511682
## Sterilized1  0.690688772 1.535365e-03 0.164162835  0.48092258  0.688819102
## Vaccinated1  0.318715747 1.655190e-03 0.179963272  0.08924947  0.318538724
## Dewormed1   -0.001789522 1.616438e-03 0.168594313 -0.21720001 -0.001004759
## 0|1         -3.355148548 2.201978e-03 0.232536209 -3.65773490 -3.349498499
## 1|2         -1.058289904 1.284121e-03 0.139953255 -1.23837624 -1.057180267
## 2|3          0.276656461 1.187258e-03 0.133952418  0.10538132  0.276139337
## 3|4          1.272267361 1.207162e-03 0.140589158  1.09125504  1.271952833
## mean_PPD:0   0.031505172 8.265987e-05 0.008632395  0.02093596  0.030788177
## mean_PPD:1   0.203957020 1.955397e-04 0.019572049  0.17980296  0.203201970
## mean_PPD:2   0.288257266 2.204405e-04 0.022416216  0.25985222  0.288177340
## mean_PPD:3   0.214343966 1.973403e-04 0.020048851  0.18965517  0.214285714
##                     90% n_eff      Rhat
## Type1       -0.12640415 14595 0.9999596
## Health1      0.89662335 12493 0.9997813
## Health2      4.02976553  9358 0.9999248
## Sterilized1  0.90384820 11432 1.0000488
## Vaccinated1  0.54993335 11821 0.9998534
## Dewormed1    0.21453193 10878 0.9998297
## 0|1         -3.06134550 11152 1.0000541
## 1|2         -0.87929294 11878 0.9998446
## 2|3          0.44947033 12729 1.0000083
## 3|4          1.45397384 13564 1.0001160
## mean_PPD:0   0.04310345 10906 0.9999094
## mean_PPD:1   0.23029557 10018 0.9999413
## mean_PPD:2   0.31650246 10341 1.0001028
## mean_PPD:3   0.24014778 10322 1.0000672</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" title="1"><span class="kw">set.seed</span>(<span class="dv">454</span>)</a>
<a class="sourceLine" id="cb32-2" title="2">model_data1&lt;-mysample <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb32-3" title="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(AdoptionSpeed, Type,Health,Sterilized,Vaccinated,Dewormed) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb32-4" title="4"><span class="st">  </span><span class="kw">na.omit</span>()</a>
<a class="sourceLine" id="cb32-5" title="5">my_prediction1 &lt;-<span class="st"> </span><span class="kw">posterior_predict</span>(</a>
<a class="sourceLine" id="cb32-6" title="6">  model1, </a>
<a class="sourceLine" id="cb32-7" title="7">  <span class="dt">newdata =</span> model_data1)</a>
<a class="sourceLine" id="cb32-8" title="8"></a>
<a class="sourceLine" id="cb32-9" title="9"><span class="kw">ordinal_accuracy</span>(my_prediction1,model_data1)</a></code></pre></div>
<pre><code>## [1] 0.2438424</code></pre>
<p>The formula using the posterior means of each variable is:
<span class="math display">\[logit(\hat P(Y\leq k))=\beta_{k0}-0.291*Type+0.442*Health1+2.290*Health2+0.691*Sterilized1
\\+0.319*Vaccinated1-0.002*Dewormed1
\\\text{For k =0,1,2,3,4}, \beta_{k0}=0,-3.62,-1.42,-0.17,0.76\text{ respectively}\]</span>
The accuracy for this model is 0.244.
If an animal has a severe injury, then the odds of that animal getting adopted slower will increase by e^2.290=9.87 times than a healthy animal, keeping all other variables constant.
We can see that the mean of Dewormed is near zero, therefore, we will exclude Dewormed in our future model.</p>
</div>
</div>
<div id="model-2" class="section level2">
<h2><span class="header-section-number">7.2</span> Model 2</h2>
<p>With further investigations, we have also found “AgeGroup” and “mix_breed” to be important factors (visualizations from the “More digging” section). We will include these in our models.</p>
<div id="model-building" class="section level3">
<h3><span class="header-section-number">7.2.1</span> Model Building</h3>
<p><span class="math display">\[
\text{Let }Y_i\text{ be the adoption speed with k=0,1,2,3,4.}
\\y_i|(\beta_{0k},\beta_1,...,\beta_10)\sim Bern(\theta_{ki})\text{ where }\theta_{ki}\text{ is the }P(Y_i\leq k)\text{ for the }i^{th}\text{ animal.}
\\log(\frac{\theta_{ki}}{1-\theta_{ki}})=logit(\hat P(Y\leq k))=\beta_{k0}+\beta_1x_1...+\beta_{10}x_{10}
\\\text{ where }x_i\text{ for i from 1 to 11 is the indicator for cat, minor/severe injury,}
\\\text{sterilization, vaccination, age groups 1-5, and Mix breed.}
\\\beta_{k0}\sim N(m_{k0},s_{k0}^2)
\\\beta_1\sim N(m_1,s_1^2)
\\...\]</span></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" title="1">model2 &lt;-<span class="st"> </span><span class="kw">stan_polr</span>(AdoptionSpeed <span class="op">~</span><span class="st"> </span>Type<span class="op">+</span>Health<span class="op">+</span>Sterilized<span class="op">+</span>Vaccinated<span class="op">+</span>AgeGroup<span class="op">+</span>MixedBreed, <span class="dt">data =</span>mysample, <span class="dt">prior=</span><span class="kw">R2</span>(<span class="fl">0.5</span>,<span class="dt">what=</span><span class="ot">NULL</span>),<span class="dt">iter=</span><span class="dv">5000</span>, <span class="dt">seed =</span> <span class="dv">454</span>)</a></code></pre></div>
</div>
<div id="posterior-inference-1" class="section level3">
<h3><span class="header-section-number">7.2.2</span> Posterior Inference</h3>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1">model2_summary&lt;-<span class="st"> </span><span class="kw">summary</span>(model2)</a>
<a class="sourceLine" id="cb35-2" title="2"><span class="kw">head</span>(<span class="kw">as.data.frame</span>(model2_summary), <span class="dv">-2</span>)</a></code></pre></div>
<pre><code>##                    mean         mcse          sd         10%         50%
## Type1        0.48778366 1.707863e-03 0.221427458  0.19976369  0.48937164
## Health1      0.47969467 3.195916e-03 0.348317802  0.03818016  0.47965636
## Health2      1.67486939 1.220502e-02 1.279389983  0.13553622  1.58676636
## Sterilized1  0.47813952 1.457010e-03 0.181320803  0.24420605  0.47770227
## Vaccinated1  0.24826375 1.199002e-03 0.149064908  0.05697017  0.24762385
## AgeGroup1    0.54348134 1.459234e-03 0.170443602  0.32467603  0.54231742
## AgeGroup2    0.66716931 1.993412e-03 0.227959035  0.37680824  0.66989071
## AgeGroup3    0.96625893 3.180660e-03 0.345682844  0.51766283  0.95983629
## AgeGroup4    0.65239525 3.793133e-03 0.437359847  0.08932112  0.64813984
## AgeGroup5    0.53430605 5.266733e-03 0.592109782 -0.22336947  0.52774019
## MixedBreed1  1.06601710 2.044574e-03 0.228975968  0.77289049  1.06582076
## 0|1         -2.45032288 2.856396e-03 0.287372279 -2.81857404 -2.44775572
## 1|2         -0.13451482 2.159830e-03 0.230288981 -0.43149332 -0.13648189
## 2|3          1.23866701 2.011140e-03 0.232081787  0.93921284  1.23811248
## 3|4          2.26420168 2.033693e-03 0.241510274  1.95486028  2.26515793
## mean_PPD:0   0.03138345 7.841415e-05 0.008449069  0.02068127  0.03041363
## mean_PPD:1   0.20154197 1.840315e-04 0.019143089  0.17761557  0.20072993
## mean_PPD:2   0.28724696 2.128690e-04 0.022075926  0.25912409  0.28710462
## mean_PPD:3   0.21470985 1.891734e-04 0.019819265  0.18978102  0.21411192
##                     90% n_eff      Rhat
## Type1        0.76985933 16810 0.9998001
## Health1      0.92512579 11878 0.9998389
## Health2      3.31114337 10988 0.9999712
## Sterilized1  0.70659244 15487 0.9997555
## Vaccinated1  0.43924717 15457 0.9997827
## AgeGroup1    0.76354356 13643 1.0000624
## AgeGroup2    0.95776625 13077 0.9998310
## AgeGroup3    1.41472859 11812 0.9996562
## AgeGroup4    1.21477049 13295 0.9997109
## AgeGroup5    1.29127895 12639 0.9998504
## MixedBreed1  1.35920999 12542 0.9997835
## 0|1         -2.08201004 10122 0.9998176
## 1|2          0.16165719 11369 0.9997512
## 2|3          1.53309341 13317 0.9998544
## 3|4          2.57697695 14103 0.9998261
## mean_PPD:0   0.04257908 11610 0.9998802
## mean_PPD:1   0.22627737 10820 1.0000967
## mean_PPD:2   0.31630170 10755 0.9999731
## mean_PPD:3   0.23965937 10976 0.9998674</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1"><span class="kw">set.seed</span>(<span class="dv">454</span>)</a>
<a class="sourceLine" id="cb37-2" title="2">model_data2&lt;-mysample <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb37-3" title="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(AdoptionSpeed, Type,Health,Sterilized,Vaccinated,AgeGroup,MixedBreed) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb37-4" title="4"><span class="st">  </span><span class="kw">na.omit</span>()</a>
<a class="sourceLine" id="cb37-5" title="5">my_prediction2 &lt;-<span class="st"> </span><span class="kw">posterior_predict</span>(</a>
<a class="sourceLine" id="cb37-6" title="6">  model2, </a>
<a class="sourceLine" id="cb37-7" title="7">  <span class="dt">newdata =</span> model_data2)</a>
<a class="sourceLine" id="cb37-8" title="8"></a>
<a class="sourceLine" id="cb37-9" title="9"><span class="kw">ordinal_accuracy</span>(my_prediction2,model_data2)</a></code></pre></div>
<pre><code>## [1] 0.2372263</code></pre>
<p>The model accuracy is 0.24.
If an animal has a severe injury, then the odds of that animal getting adopted slower will increase by e^2.290=9.87 times than a healthy animal, keeping all other variables constant.
We can see that the mean of Dewormed is near zero, therefore, we will exclude Dewormed in our future model.
If an animal is in age group 1(4 to 11 months), then the odds of that animal getting adopted slower will increase by e^0.5=1.65 times than an animal that is in age group 0 (0 to 3 months), keeping all other variables constant. Similar situations apply to other age groups as well. From this, we can reasonably infer that animals in age group 0 are the most popular.
If an animal is a Mixed Breed, then the odds of that animal getting adopted slower will increase by e^1.1=3.00 times than an animal that is not mixed breed, keeping all other variables constant.</p>
</div>
</div>
<div id="making-some-adjustments" class="section level2">
<h2><span class="header-section-number">7.3</span> Making some adjustments</h2>
<p>Our accuracy is less than ideal. One reason behind this could be due to how adoption speed is grouped. Group 0 is being adopted the day of, group 1 is being adopted between 2-7 days, and group 2 is being adopted between 8-30 days. The difference between group 0,1, and 2 can be due to chance.
Therefore, I’ve decided to group groups 0,1, and 2 into 1 group. In our future models, we will be predicting for 3 adoption speed groups.</p>
</div>
<div id="model-3" class="section level2">
<h2><span class="header-section-number">7.4</span> Model 3</h2>
<p>In this model, we will be adding two interaction terms. The figure below shows that the younger the animal is, the less likely it will get sterilized, since the procedure can’t be done when they are young. I have also realized that only dogs can be marked as mixed breed. Therefore, we will add two interaction terms: Type<span class="math inline">\(*\)</span>MixedBreed and AgeGroup<span class="math inline">\(*\)</span>Sterilization.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" title="1"><span class="kw">set.seed</span>(<span class="dv">454</span>)</a>
<a class="sourceLine" id="cb39-2" title="2">mysample2 &lt;-<span class="st"> </span>adoption[<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(adoption), <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb39-3" title="3">   <span class="dt">replace=</span><span class="ot">FALSE</span>),]</a></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" title="1">ordinal_accuracy2&lt;-<span class="cf">function</span>(post_preds,mydata){</a>
<a class="sourceLine" id="cb40-2" title="2">  post_preds&lt;-<span class="kw">as.data.frame</span>(post_preds)</a>
<a class="sourceLine" id="cb40-3" title="3">  results&lt;-<span class="kw">c</span>()</a>
<a class="sourceLine" id="cb40-4" title="4">  <span class="cf">for</span> (j <span class="cf">in</span> (<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(post_preds))){</a>
<a class="sourceLine" id="cb40-5" title="5">    results[j]&lt;-<span class="kw">as.numeric</span>(<span class="kw">tail</span>(<span class="kw">names</span>(<span class="kw">sort</span>(<span class="kw">table</span>(post_preds[,j]))))[<span class="dv">3</span>])</a>
<a class="sourceLine" id="cb40-6" title="6">    }</a>
<a class="sourceLine" id="cb40-7" title="7">  results&lt;-<span class="kw">as.data.frame</span>(results)</a>
<a class="sourceLine" id="cb40-8" title="8">  compare&lt;-<span class="kw">cbind</span>(results,mydata<span class="op">$</span>AdoptionSpeed_Group)</a>
<a class="sourceLine" id="cb40-9" title="9">  compare&lt;-compare <span class="op">%&gt;%</span><span class="kw">mutate</span>(<span class="dt">results=</span><span class="kw">as.numeric</span>(results))</a>
<a class="sourceLine" id="cb40-10" title="10">  compare&lt;-compare <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">mydata$AdoptionSpeed_Group</span><span class="st">`</span>=<span class="kw">as.numeric</span>(<span class="st">`</span><span class="dt">mydata$AdoptionSpeed_Group</span><span class="st">`</span>))</a>
<a class="sourceLine" id="cb40-11" title="11">  compare&lt;-compare <span class="op">%&gt;%</span><span class="kw">mutate</span>(<span class="dt">accuracy=</span><span class="kw">ifelse</span>(<span class="kw">as.numeric</span>(results)<span class="op">==</span><span class="kw">as.numeric</span>(<span class="st">`</span><span class="dt">mydata$AdoptionSpeed_Group</span><span class="st">`</span>),<span class="dv">1</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb40-12" title="12">  <span class="kw">print</span>(<span class="kw">sum</span>(compare<span class="op">$</span>accuracy)<span class="op">/</span><span class="kw">length</span>(post_preds))</a>
<a class="sourceLine" id="cb40-13" title="13">}</a></code></pre></div>
<div id="model-building-1" class="section level3">
<h3><span class="header-section-number">7.4.1</span> Model Building</h3>
<p><span class="math display">\[
\text{Let }Y_i\text{ be the adoption speed with k=0,1,2.}
\\y_i|(\beta_{0k},\beta_1,...,\beta_16)\sim Bern(\theta_{ki})\text{ where }\theta_{ki}\text{ is the }P(Y_i\leq k)\text{ for the }i^{th}\text{ animal.}
\\log(\frac{\theta_{ki}}{1-\theta_{ki}})=logit(\hat P(Y\leq k))=\beta_{k0}+\beta_1x_1...+\beta_{10}x_{10}+\beta_{11}x_1*x_10+\beta_{12}x_2*x_5+...+\beta_{16}x_2*x_9
\\\text{ where }x_i\text{ for i from 1 to 10 is the indicator for cat, minor/severe injury,}
\\\text{sterilization, vaccination, age groups 1-5, and Mix breed.}
\\\beta_{12}\text{ is the coefficient for the interaction term of Type*MixedBreed, and }\beta_{13}\text{ to }
\\\beta_{16}\text{ are the coefficients for the interaction terms of AgeGroup*Sterilization.}
\\\beta_{k0}\sim N(m_{k0},s_{k0}^2)
\\\beta_1\sim N(m_1,s_1^2)
\\...\]</span></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" title="1">model3 &lt;-<span class="st"> </span><span class="kw">stan_polr</span>(AdoptionSpeed_Group <span class="op">~</span><span class="st"> </span>Type<span class="op">+</span>MixedBreed<span class="op">+</span>Health<span class="op">+</span>Vaccinated<span class="op">+</span>AgeGroup<span class="op">+</span>Sterilized, <span class="dt">data=</span>mysample2, <span class="dt">prior=</span><span class="kw">R2</span>(<span class="fl">0.5</span>,<span class="dt">what=</span> <span class="ot">NULL</span>),<span class="dt">iter=</span><span class="dv">5000</span>, <span class="dt">seed =</span> <span class="dv">454</span>)</a></code></pre></div>
</div>
<div id="posterior-inference-2" class="section level3">
<h3><span class="header-section-number">7.4.2</span> Posterior Inference</h3>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" title="1">model3_summary&lt;-<span class="st"> </span><span class="kw">summary</span>(model3)</a>
<a class="sourceLine" id="cb42-2" title="2"><span class="kw">head</span>(<span class="kw">as.data.frame</span>(model3_summary), <span class="dv">-2</span>)</a></code></pre></div>
<pre><code>##                  mean         mcse         sd         10%       50%       90%
## Type1       0.3451827 0.0019710823 0.23476422  0.04353292 0.3425949 0.6421678
## MixedBreed1 0.9758830 0.0022277932 0.24084355  0.66773156 0.9752728 1.2843762
## Health1     0.5549085 0.0031939476 0.35711011  0.09364087 0.5573441 1.0099537
## Health2     1.6569184 0.0128234459 1.29691140  0.12056026 1.5538236 3.3182407
## Vaccinated1 0.1700844 0.0012275795 0.16079859 -0.03401840 0.1706597 0.3776179
## AgeGroup1   0.5505604 0.0016178448 0.18017912  0.31706524 0.5493472 0.7840974
## AgeGroup2   0.7259747 0.0019790205 0.23643728  0.42795142 0.7253973 1.0323629
## AgeGroup3   0.9113914 0.0030942282 0.35135824  0.46744848 0.9097726 1.3594050
## AgeGroup4   0.5862925 0.0040405589 0.47104174 -0.01181623 0.5814861 1.1957654
## AgeGroup5   0.3243656 0.0055521388 0.64586317 -0.51509322 0.3412998 1.1392635
## Sterilized1 0.5207101 0.0016653392 0.18600371  0.28016222 0.5200531 0.7599464
## 1|2         1.1190016 0.0022699191 0.24307702  0.80645532 1.1160157 1.4277635
## 2|3         2.1449649 0.0022639660 0.25308847  1.82145025 2.1405737 2.4761848
## mean_PPD:1  0.5203933 0.0002372490 0.02376417  0.49026764 0.5206813 0.5510949
## mean_PPD:2  0.2144968 0.0002032269 0.02032452  0.18856448 0.2141119 0.2408759
##             n_eff      Rhat
## Type1       14186 0.9997899
## MixedBreed1 11687 0.9999682
## Health1     12501 1.0000555
## Health2     10228 1.0002430
## Vaccinated1 17158 0.9996834
## AgeGroup1   12403 1.0002466
## AgeGroup2   14274 0.9998599
## AgeGroup3   12894 0.9997617
## AgeGroup4   13591 0.9999414
## AgeGroup5   13532 0.9999226
## Sterilized1 12475 1.0003604
## 1|2         11467 0.9998890
## 2|3         12497 0.9998815
## mean_PPD:1  10033 1.0001560
## mean_PPD:2  10002 0.9998024</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" title="1"><span class="kw">set.seed</span>(<span class="dv">454</span>)</a>
<a class="sourceLine" id="cb44-2" title="2">model_data3&lt;-mysample2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb44-3" title="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(AdoptionSpeed_Group, Type,Health,Sterilized,Vaccinated,AgeGroup,MixedBreed) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb44-4" title="4"><span class="st">  </span><span class="kw">na.omit</span>()</a>
<a class="sourceLine" id="cb44-5" title="5">my_prediction3 &lt;-<span class="st"> </span><span class="kw">posterior_predict</span>(</a>
<a class="sourceLine" id="cb44-6" title="6">  model3,</a>
<a class="sourceLine" id="cb44-7" title="7">  <span class="dt">newdata =</span> model_data3)</a>
<a class="sourceLine" id="cb44-8" title="8"></a>
<a class="sourceLine" id="cb44-9" title="9"><span class="kw">ordinal_accuracy2</span>(my_prediction3,model_data3)</a></code></pre></div>
<pre><code>## [1] 0.5596107</code></pre>
<p>The model accuracy is 0.560, that’s a big improvement!</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ordered-logistic-regression.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="final-model.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
